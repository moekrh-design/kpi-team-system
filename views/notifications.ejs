<%- include('partials/header', { pageTitle: 'الإشعارات' }) %>

<div class="card">
  <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
    <h2 style="margin:0">الإشعارات</h2>

    <form method="post" action="/notifications/mark-read" class="noPrint" style="margin:0">
      <input type="hidden" name="id" value="all" />
      <button class="btn" type="submit">تحديد الكل كمقروء</button>
    </form>
  </div>

  <div class="small" style="margin-top:6px;color:#666">
    آخر 200 إشعار.
  </div>

  <div style="margin-top:12px;display:flex;flex-direction:column;gap:10px">
    <% if (!rows || rows.length === 0) { %>
      <div class="notice">لا توجد إشعارات حالياً.</div>
    <% } %>

    <% (rows || []).forEach(n => { %>
      <div class="card" style="margin:0;border-color:<%= n.is_read ? 'rgba(0,0,0,.08)' : 'rgba(14,165,233,.35)' %>">
        <div style="display:flex;gap:10px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap">
          <div>
            <div style="font-weight:<%= n.is_read ? 600 : 900 %>"><%= n.title %></div>
            <% if (n.body) { %>
              <div class="small" style="margin-top:4px;color:#555"><%= n.body %></div>
            <% } %>
            <div class="small" style="margin-top:6px;color:#999"><%= n.created_at %></div>
          </div>

          <div style="display:flex;gap:8px;align-items:center" class="noPrint">
            <a class="btn btnGood" href="/notifications/open/<%= n.id %>">فتح</a>
            <% if (!n.is_read) { %>
              <form method="post" action="/notifications/mark-read" style="margin:0">
                <input type="hidden" name="id" value="<%= n.id %>" />
                <button class="btn" type="submit">تحديد كمقروء</button>
              </form>
            <% } %>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
</div>

<%- include('partials/footer') %>
